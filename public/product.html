<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details | RJ Sports</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script>
        if (localStorage.getItem('rj_theme') === 'dark') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
    <style>
        :root {
            --bg: #f4f6f8;
            --text: #1f2937;
            --header-bg: #fff;
            --card-bg: #fff;
            --border: #e5e7eb;
            --accent: #E10600; 
            --secondary: #121212;
        }

        html.dark-mode {
            --bg: #121212;
            --text: #e5e7eb;
            --header-bg: #1f2937;
            --card-bg: #1e293b;
            --border: #374151;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Assistant', sans-serif; }
        body { background-color: var(--bg); color: var(--text); line-height: 1.6; }

        /* HEADER */
        .header { background: var(--header-bg); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-size: 24px; font-weight: 900; text-decoration: none; color: var(--text); text-transform: uppercase; }
        .logo span { color: var(--accent); }
        .cart-icon { position: relative; text-decoration: none; font-size: 22px; color: var(--text); }
        .cart-count { position: absolute; top: -8px; right: -12px; background: var(--accent); color: white; font-size: 11px; font-weight: bold; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }

        /* PRODUCT LAYOUT */
        .product-layout { max-width: 1200px; margin: 30px auto; display: flex; gap: 50px; padding: 0 20px; }
        .image-sec { width: 55%; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-content: start; }
        .image-sec img { width: 100%; border-radius: 8px; background: #fff; border: 1px solid var(--border); transition: 0.3s; cursor: zoom-in; }
        .image-sec img:hover { transform: scale(1.02); }

        /* DETAIL SECTION */
        .detail-sec { width: 45%; position: sticky; top: 90px; height: fit-content; }
        .brand-tag { font-weight: 800; color: var(--accent); letter-spacing: 1px; font-size: 14px; margin-bottom: 8px; text-transform: uppercase; }
        .product-name { font-size: 32px; font-weight: 800; margin-bottom: 10px; line-height: 1.2; }
        .rating-row { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; color: #ffa41c; font-size: 14px; }
        .review-count { color: #878787; font-weight: 600; }

        .price-section { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .current-price { font-size: 34px; font-weight: 900; color: var(--text); }
        .mrp { text-decoration: line-through; color: #878787; font-size: 20px; font-weight: 600; }
        .discount-tag { background: #e8f5e9; color: #388e3c; border: 1px dashed #388e3c; padding: 4px 10px; font-size: 13px; font-weight: 800; border-radius: 4px; }

        /* SIZES */
        .size-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: 800; }
        .size-grid { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 30px; }
        .size-btn { width: 55px; height: 55px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text); font-weight: 800; font-size: 16px; cursor: pointer; border-radius: 4px; transition: 0.2s; }
        .size-btn:hover:not(:disabled) { border-color: var(--accent); color: var(--accent); }
        .size-btn.selected { background: var(--accent); color: #fff; border-color: var(--accent); }
        .size-btn:disabled { opacity: 0.3; cursor: not-allowed; text-decoration: line-through; }

        /* BUTTONS */
        .btn-add { width: 100%; padding: 20px; background: var(--secondary); color: white; border: none; font-weight: 800; font-size: 16px; border-radius: 4px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; text-transform: uppercase; }
        .btn-add:hover:not(:disabled) { background: var(--accent); transform: translateY(-2px); }
        
        /* MODERN DESCRIPTION TABS */
        .desc-container { margin-top: 40px; border-top: 1px solid var(--border); padding-top: 20px; }
        .tab-buttons { display: flex; gap: 20px; margin-bottom: 20px; overflow-x: auto; white-space: nowrap; }
        .tab-btn { background: none; border: none; font-size: 16px; font-weight: 800; color: #878787; cursor: pointer; padding-bottom: 10px; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: var(--text); border-bottom-color: var(--accent); }
        
        .tab-content { display: none; font-size: 15px; color: #535665; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* LIST STYLING IN TABS */
        .feature-list { list-style: none; margin-top: 10px; }
        .feature-list li { margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; }
        .feature-list i { color: var(--accent); margin-top: 4px; }

        .ideal-tags { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .ideal-tag { background: #f0f0f0; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; color: #333; }

        /* MOBILE STICKY BAR */
        .mobile-cta-bar { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card-bg); padding: 15px 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 2000; border-top: 1px solid var(--border); }

        @media (max-width: 768px) {
            .product-layout { flex-direction: column; padding-bottom: 90px; gap: 20px; }
            .image-sec { width: 100%; grid-template-columns: 1fr; }
            .detail-sec { width: 100%; position: static; }
            .mobile-cta-bar { display: block; }
            .desktop-btn { display: none; }
            .product-name { font-size: 24px; }
            .current-price { font-size: 28px; }
        }

        .loading-text { margin: 50px auto; font-size: 20px; text-align: center; width: 100%; font-weight: 800; color: var(--accent); }
    </style>
</head>
<body>

<header class="header">
    <a href="index.html" class="logo">RJ <span>SPORTS</span></a>
    <a href="cart.html" class="cart-icon">
        <i class="fas fa-shopping-bag"></i>
        <span class="cart-count" id="cart-count">0</span>
    </a>
</header>

<div class="product-layout" id="product-content">
    <div class="loading-text"><i class="fas fa-spinner fa-spin"></i> PREPARING GEAR...</div>
</div>

<div class="mobile-cta-bar">
    <button class="btn-add" style="padding: 15px;" onclick="addToCart()">ADD TO BAG <i class="fas fa-arrow-right"></i></button>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    let currentProduct = null;

    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('rj_cart')) || [];
        document.getElementById('cart-count').innerText = cart.length;
    }

    async function loadDetail() {
        if(!productId) return;
        try {
            const res = await fetch(`/api/products/${productId}`);
            const data = await res.json();
            if(!data.success) return;

            currentProduct = data.product;
            const p = currentProduct;
            const mrp = Math.round(p.price * 1.4);
            const savings = mrp - p.price;
            
            const imagesHtml = p.images.map(img => `<img src="${img.startsWith('http') ? img : '/'+img}" alt="${p.name}">`).join('');
            
            // Sizes Logic
            const sizes = [6, 7, 8, 9, 10, 11];
            const disabledArray = p.disabledSizes || [];
            const sizesHtml = sizes.map(sz => {
                const isDisabled = disabledArray.includes(sz.toString());
                return `<button class="size-btn" ${isDisabled ? 'disabled' : ''} onclick="selectSize(this)">${sz}</button>`;
            }).join('');

            document.getElementById('product-content').innerHTML = `
                <div class="image-sec">${imagesHtml}</div>
                <div class="detail-sec">
                    <p class="brand-tag">${p.brand || 'RJ OFFICIAL'}</p>
                    <h1 class="product-name">${p.name}</h1>
                    <div class="rating-row">
                        ‚≠ê‚≠ê‚≠ê‚≠ê‚òÖ <span class="review-count">4.8 (1,284 Reviews)</span>
                    </div>
                    
                    <div class="price-section">
                        <span class="current-price">‚Çπ${p.price.toLocaleString()}</span>
                        <span class="mrp">‚Çπ${mrp.toLocaleString()}</span>
                        <span class="discount-tag">Save ‚Çπ${savings.toLocaleString()}</span>
                    </div>

                    <div class="size-header">
                        <span>SELECT UK SIZE</span>
                        <a href="#" style="color: var(--accent); font-size: 13px; text-decoration: none;">Size Guide</a>
                    </div>
                    <div class="size-grid">${sizesHtml}</div>

                    <div class="desktop-btn">
                        <button class="btn-add" onclick="addToCart()" ${p.isOutOfStock ? 'disabled' : ''}>
                            <i class="fas fa-shopping-bag"></i> ${p.isOutOfStock ? 'OUT OF STOCK' : 'ADD TO BAG'}
                        </button>
                    </div>

                    <div class="desc-container">
                        <div class="tab-buttons">
                            <button class="tab-btn active" onclick="switchTab(event, 'tab-desc')">Description</button>
                            <button class="tab-btn" onclick="switchTab(event, 'tab-features')">Key Features</button>
                            <button class="tab-btn" onclick="switchTab(event, 'tab-delivery')">Delivery</button>
                        </div>

                        <div id="tab-desc" class="tab-content active">
                            <p><strong>RJ Sports</strong> brings you a complete collection of high-quality sports footwear and accessories designed to enhance your game. Whether you're a beginner stepping onto the field for the first time or a professional preparing for a tournament, RJ Sports offers durable, comfortable, and performance-driven gear.</p>
                            <br>
                            <p>Our gear provides superior grip, stability, and all-day comfort, ensuring maximum protection and confidence during matches. <strong>Upgrade your sports experience with RJ Sports ‚Äì where quality meets performance. üèÜ</strong></p>
                            
                            <div class="ideal-tags">
                                <span class="ideal-tag">School/College Players</span>
                                <span class="ideal-tag">Club Cricketers</span>
                                <span class="ideal-tag">Professionals</span>
                                <span class="ideal-tag">Fitness Enthusiasts</span>
                            </div>
                        </div>

                        <div id="tab-features" class="tab-content">
                            <ul class="feature-list">
                                <li><i class="fas fa-check-circle"></i> <strong>Wide Range:</strong> Running shoes, training shoes, and cricket gear designed for performance.</li>
                                <li><i class="fas fa-check-circle"></i> <strong>Premium Accessories:</strong> Cricket bats, gloves, pads, helmets, and grips.</li>
                                <li><i class="fas fa-check-circle"></i> <strong>High-Quality:</strong> Long-lasting footwear built for tough matches and daily training.</li>
                                <li><i class="fas fa-check-circle"></i> <strong>Comfort Focused:</strong> Breathable materials, strong grip soles, and shock-absorbing design.</li>
                                <li><i class="fas fa-check-circle"></i> <strong>Indian Conditions:</strong> Specifically designed to last long on Indian playing surfaces.</li>
                            </ul>
                        </div>

                        <div id="tab-delivery" class="tab-content">
                            <ul class="feature-list">
                                <li><i class="fas fa-truck"></i> <strong>Fast Delivery:</strong> Dispatch within 24 hours.</li>
                                <li><i class="fas fa-hand-holding-dollar"></i> <strong>COD Available:</strong> Pay when you receive your order.</li>
                                <li><i class="fas fa-undo"></i> <strong>Easy Returns:</strong> 7 days hassle-free return policy.</li>
                            </ul>
                        </div>
                    </div>

                </div>
            `;
        } catch (err) {
            document.getElementById('product-content').innerHTML = "<div class='loading-text'>OFFLINE... CHECK CONNECTION</div>";
        }
    }

    // Tab Switching Logic
    function switchTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
    }

    function selectSize(btn) {
        document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    function addToCart() {
        const selectedBtn = document.querySelector('.size-btn.selected');
        if(!selectedBtn) return alert("Please select your size first!");
        
        let cart = JSON.parse(localStorage.getItem('rj_cart')) || [];
        cart.push({
            id: currentProduct.productId,
            name: currentProduct.name,
            price: currentProduct.price,
            size: selectedBtn.innerText,
            image: currentProduct.images[0],
            quantity: 1
        });
        localStorage.setItem('rj_cart', JSON.stringify(cart));
        updateCartCount();
        window.location.href = 'cart.html';
    }

    window.onload = () => {
        updateCartCount();
        loadDetail();
    };
</script>
</body>
</html>