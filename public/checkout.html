<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout | RJ Sports</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #121212;
            --header-bg: #fff;
            --card-bg: #fff;
            --border-color: #e5e7eb;
            --accent: #E10600; 
            --green: #03a685;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Assistant', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); padding-bottom: 80px; }

        .header { background: var(--header-bg); padding: 15px 5%; box-shadow: 0 1px 4px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 24px; font-weight: 900; text-decoration: none; color: var(--text-color); text-transform: uppercase; }
        .logo span { color: var(--accent); }

        .checkout-wrapper { max-width: 1100px; margin: 30px auto; display: flex; gap: 30px; padding: 0 20px; align-items: flex-start; }
        .left-column { flex: 1.5; display: flex; flex-direction: column; gap: 20px; }
        .right-column { flex: 1; position: sticky; top: 80px; }

        .checkout-section { background: var(--card-bg); border-radius: 8px; padding: 25px; border: 1px solid var(--border-color); }
        .section-title { font-size: 18px; font-weight: 800; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; text-transform: uppercase; }
        .section-title i { color: var(--accent); }

        .form-group { margin-bottom: 15px; }
        .form-group label { font-size: 13px; font-weight: 700; display: block; margin-bottom: 5px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-weight: 600; }

        .summary-card { background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color); overflow: hidden; }
        .summary-items { max-height: 300px; overflow-y: auto; padding: 20px; border-bottom: 1px solid var(--border-color); }
        
        /* Summary UI */
        .s-item { display: flex; gap: 15px; margin-bottom: 15px; }
        .s-img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; }
        .s-name { font-weight: 800; font-size: 14px; }
        
        .calc-total { font-size: 20px; font-weight: 900; padding-top: 15px; border-top: 1px dashed #ccc; display: flex; justify-content: space-between; }
        
        .btn-place-order { background: var(--accent); color: white; border: none; padding: 18px; font-size: 16px; font-weight: 800; border-radius: 6px; cursor: pointer; width: 100%; }

        #toast { visibility: hidden; background: #333; color: #fff; padding: 15px; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 5000; border-radius: 5px; }
        #toast.show { visibility: visible; }

        @media (max-width: 768px) {
            .checkout-wrapper { flex-direction: column-reverse; }
            .right-column { position: static; }
        }
    </style>
</head>
<body>

    <header class="header">
        <a href="index.html" class="logo">RJ <span>SPORTS</span></a>
    </header>

    <div class="checkout-wrapper">
        <div class="left-column">
            <div class="checkout-section">
                <div class="section-title"><i class="fas fa-user"></i> Contact Details</div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="c-name" class="form-input" placeholder="Your Name">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="c-phone" class="form-input" maxlength="10">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" id="s-address" class="form-input" placeholder="Building, Area">
                </div>
                <button class="btn-place-order" onclick="placeOrder()">PLACE ORDER</button>
            </div>
        </div>

        <div class="right-column">
            <div class="summary-card">
                <div class="summary-items" id="checkout-items"></div>
                
                <div style="padding: 20px;">
                    <div class="calc-total">
                        <span>Total:</span>
                        <span id="t-final">₹0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <script>
    let cartItems = [];
    let finalTotal = 0;

    document.addEventListener('DOMContentLoaded', () => {
        cartItems = JSON.parse(localStorage.getItem('rj_cart')) || [];
        
        // चेक करा की कार्टमध्ये काही आहे का
        if (cartItems.length === 0) {
            alert("कार्ट रिकामे आहे!");
            window.location.href = 'index.html';
            return;
        }
        renderSummary();
    });

    function renderSummary() {
        const itemsContainer = document.getElementById('checkout-items');
        const finalTotalEl = document.getElementById('t-final');

        // जर element सापडले नाहीत तर एरर टाळा
        if (!itemsContainer || !finalTotalEl) return;

        let html = '';
        let total = 0;

        cartItems.forEach(item => {
            const price = parseFloat(item.price);
            const qty = item.quantity || 1;
            total += (price * qty);
            
            html += `
                <div class="s-item">
                    <img src="${item.image || ''}" class="s-img">
                    <div class="s-info">
                        <div class="s-name">${item.name}</div>
                        <div style="font-size:12px;">Qty: ${qty} | Size: ${item.size}</div>
                        <div style="font-weight:700;">₹${price.toLocaleString()}</div>
                    </div>
                </div>`;
        });

        finalTotal = total;
        itemsContainer.innerHTML = html;
        finalTotalEl.innerText = `₹${total.toLocaleString()}`;
    }

    function generateInvoice(orderData) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // प्रीमियम डिझाइन: वरचा गडद पट्टा
        doc.setFillColor(18, 18, 18);
        doc.rect(0, 0, 210, 40, 'F');

        doc.setFontSize(26);
        doc.setTextColor(255, 255, 255);
        doc.text("RJ", 20, 25);
        doc.setTextColor(225, 6, 0); 
        doc.text("SPORTS", 35, 25);

        doc.setTextColor(0, 0, 0);
        doc.setFontSize(10);
        doc.text(`Order ID: #${orderData.orderId}`, 150, 50);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 150, 55);

        doc.setFont("helvetica", "bold");
        doc.text("Bill To:", 20, 50);
        doc.setFont("helvetica", "normal");
        doc.text(`${orderData.customer}\n${orderData.phone}\n${orderData.address}`, 20, 55);

        const tableRows = orderData.items.map(item => [
            item.name, item.size, item.quantity, `INR ${item.price}`
        ]);

        doc.autoTable({
            startY: 75,
            head: [['Product', 'Size', 'Qty', 'Price']],
            body: tableRows,
            theme: 'striped',
            headStyles: { fillColor: [18, 18, 18] }
        });

        doc.setFontSize(14);
        doc.text(`TOTAL: INR ${orderData.total.toLocaleString()}`, 140, doc.lastAutoTable.finalY + 20);
        
        doc.save(`Invoice_${orderData.orderId}.pdf`);
    }

    async function placeOrder() {
        const name = document.getElementById('c-name').value;
        const phone = document.getElementById('c-phone').value;
        const address = document.getElementById('s-address').value;

        if (!name || phone.length !== 10) {
            alert("कृपया सर्व माहिती अचूक भरा!");
            return;
        }

        const orderId = 'RJ' + Math.floor(Math.random() * 1000000);
        const orderData = { orderId, customer: name, phone, address, items: cartItems, total: finalTotal };

        generateInvoice(orderData); // बिल डाऊनलोड होईल
        
        alert("ऑर्डर यशस्वी झाली! व्हॉट्सॲपवर पाठवत आहोत...");
        
        // व्हॉट्सॲप मेसेज
        const msg = encodeURIComponent(`नवीन ऑर्डर: #${orderId}\nग्राहक: ${name}\nएकूण: ₹${finalTotal}`);
        window.location.href = `https://wa.me/919359239161?text=${msg}`;
    }
    </script>
</body>
</html>