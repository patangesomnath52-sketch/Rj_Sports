<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout | RJ Sports</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #121212;
            --accent: #E10600; /* RJ Sports Red */
            --border-color: #e5e7eb;
            --card-bg: #fff;
            --green: #03a685;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Assistant', sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); padding-bottom: 100px; }

        .header { background: #fff; padding: 15px 5%; box-shadow: 0 1px 4px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 22px; font-weight: 900; text-decoration: none; color: #121212; text-transform: uppercase; }
        .logo span { color: var(--accent); }

        .checkout-wrapper { max-width: 1100px; margin: 20px auto; display: flex; gap: 20px; padding: 0 15px; }
        .left-column { flex: 1.5; display: flex; flex-direction: column; gap: 15px; }
        .right-column { flex: 1; position: sticky; top: 80px; height: fit-content; }

        .checkout-card { background: var(--card-bg); border-radius: 8px; padding: 20px; border: 1px solid var(--border-color); box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .section-title { font-size: 16px; font-weight: 800; margin-bottom: 15px; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
        .section-title i { color: var(--accent); }

        .form-group { margin-bottom: 15px; }
        .form-group label { font-size: 13px; font-weight: 700; display: block; margin-bottom: 5px; color: #535665; }
        .form-input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 4px; font-weight: 600; font-size: 14px; outline: none; transition: 0.3s; }
        .form-input:focus { border-color: var(--accent); }

        .payment-option { border: 2px solid var(--accent); background: #fff5f5; padding: 15px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .opt-info { display: flex; align-items: center; gap: 10px; font-weight: 800; }
        .opt-info i { color: var(--accent); font-size: 20px; }

        .summary-items { max-height: 250px; overflow-y: auto; padding-bottom: 15px; }
        .s-item { display: flex; gap: 12px; margin-bottom: 12px; border-bottom: 1px solid #f0f0f0; padding-bottom: 12px; }
        .s-img { width: 60px; height: 60px; border-radius: 4px; object-fit: cover; }
        .s-name { font-weight: 800; font-size: 14px; margin-bottom: 3px; }
        .price-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 8px; font-weight: 600; }
        .discount { color: var(--green); }
        .total-row { border-top: 1px dashed #ccc; padding-top: 10px; margin-top: 10px; font-size: 20px; font-weight: 900; display: flex; justify-content: space-between; }
        .savings-alert { background: #e8f5e9; color: var(--green); padding: 10px; border-radius: 4px; text-align: center; font-size: 13px; font-weight: 800; margin-top: 15px; }

        .mobile-footer { position: fixed; bottom: 0; width: 100%; background: #fff; padding: 15px 20px; box-shadow: 0 -4px 15px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: space-between; z-index: 1001; }
        .footer-price { display: flex; flex-direction: column; }
        .footer-price span { font-size: 22px; font-weight: 900; }
        .footer-price small { font-size: 11px; color: #878787; font-weight: 700; }
        .btn-place-order { background: var(--accent); color: white; border: none; padding: 15px 25px; font-size: 16px; font-weight: 800; border-radius: 4px; cursor: pointer; transition: 0.3s; }
        
        .trust-badges { display: flex; justify-content: space-between; margin-top: 15px; }
        .badge { font-size: 11px; font-weight: 700; text-align: center; color: #535665; flex: 1; }
        .badge i { display: block; font-size: 18px; margin-bottom: 5px; color: var(--green); }

        #toast { visibility: hidden; min-width: 250px; background: #333; color: #fff; text-align: center; border-radius: 4px; padding: 15px; position: fixed; z-index: 3000; left: 50%; top: 20px; transform: translateX(-50%); font-weight: bold; }
        #toast.show { visibility: visible; }

        @media (max-width: 768px) {
            .checkout-wrapper { flex-direction: column-reverse; }
            .right-column { position: static; }
            .desktop-only { display: none; }
        }
    </style>
</head>
<body>

<header class="header">
    <a href="index.html" class="logo">RJ <span>SPORTS</span></a>
    <div style="font-size: 12px; font-weight: 800; color: var(--green);"><i class="fas fa-lock"></i> 100% SECURE</div>
</header>

<div class="checkout-wrapper">
    <div class="left-column">
        <section class="checkout-card">
            <div class="section-title"><i class="fas fa-id-card"></i> 1. Contact Information</div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="c-name" class="form-input" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="c-phone" class="form-input" placeholder="10-digit mobile number" maxlength="10">
            </div>
            <label style="font-size: 13px; font-weight: 700; cursor: pointer;">
                <input type="checkbox" checked id="c-whatsapp"> Get order updates on WhatsApp <i class="fab fa-whatsapp" style="color: #25D366;"></i>
            </label>
        </section>

        <section class="checkout-card">
            <div class="section-title"><i class="fas fa-map-marker-alt"></i> 2. Shipping Address</div>
            <div class="form-group">
                <label>Pincode (Auto-detects City & State)</label>
                <input type="tel" id="s-pin" class="form-input" placeholder="e.g. 431001" maxlength="6" oninput="autoDetectLocation()">
            </div>
            <div class="form-group">
                <label>Address (House No, Building, Area)</label>
                <input type="text" id="s-address" class="form-input" placeholder="Enter full address">
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;">
                    <label>City</label>
                    <input type="text" id="s-city" class="form-input" placeholder="City">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>State</label>
                    <input type="text" id="s-state" class="form-input" placeholder="State">
                </div>
            </div>
        </section>

        <section class="checkout-card">
            <div class="section-title"><i class="fas fa-wallet"></i> 3. Payment Method</div>
            <div class="payment-option">
                <div class="opt-info">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Cash on Delivery (COD)</span>
                </div>
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="trust-badges">
                <div class="badge"><i class="fas fa-shield-alt"></i> Secure</div>
                <div class="badge"><i class="fas fa-undo"></i> 7 Days</div>
                <div class="badge"><i class="fas fa-truck"></i> Free</div>
                <div class="badge"><i class="fas fa-check-double"></i> COD</div>
            </div>
        </section>
    </div>

    <aside class="right-column">
        <div class="checkout-card">
            <div class="section-title">Order Summary</div>
            <div id="checkout-items" class="summary-items"></div>
            <div class="price-breakdown">
                <div class="price-row"><span>Subtotal</span><span id="sub-total">‚Çπ0</span></div>
                <div class="price-row discount"><span>You Saved</span><span id="saved-amt">-‚Çπ0</span></div>
                <div class="price-row"><span>Shipping</span><span style="color: var(--green);">FREE</span></div>
                <div class="total-row">
                    <span>Total</span>
                    <span id="t-final">‚Çπ0</span>
                </div>
            </div>
            <div class="savings-alert" id="savings-msg">üî• You saved ‚Çπ0 today!</div>
        </div>
    </aside>
</div>

<div class="mobile-footer">
    <div class="footer-price">
        <span id="m-final">‚Çπ0</span>
        <small>Total Amount</small>
    </div>
    <button class="btn-place-order" onclick="placeOrder()">PLACE ORDER <i class="fas fa-arrow-right"></i></button>
</div>

<div id="toast">Message</div>

<script>
    let cartItems = [];
    let finalTotal = 0;

    document.addEventListener('DOMContentLoaded', () => {
        cartItems = JSON.parse(localStorage.getItem('rj_cart')) || [];
        if (cartItems.length === 0) {
            alert("Your bag is empty!");
            window.location.href = 'index.html';
            return;
        }
        renderSummary();
    });

    function showToast(msg) {
        const toast = document.getElementById("toast");
        toast.innerText = msg;
        toast.className = "show";
        setTimeout(() => { toast.className = ""; }, 3000);
    }

    function renderSummary() {
        const itemsContainer = document.getElementById('checkout-items');
        let html = '';
        let actualTotal = 0;
        let mrpTotal = 0;

        cartItems.forEach(item => {
            const price = parseFloat(item.price);
            const mrp = Math.round(price * 1.4); 
            const qty = item.quantity || 1;
            
            actualTotal += (price * qty);
            mrpTotal += (mrp * qty);
            
            html += `
                <div class="s-item">
                    <img src="${item.image || ''}" class="s-img">
                    <div class="s-info">
                        <div class="s-name">${item.name}</div>
                        <div style="font-size:12px; font-weight: 700; color: #878787;">Size: UK ${item.size} | Qty: ${qty}</div>
                        <div style="font-weight:900; margin-top:5px;">‚Çπ${price.toLocaleString()}</div>
                    </div>
                </div>`;
        });

        const savings = mrpTotal - actualTotal;
        finalTotal = actualTotal;

        itemsContainer.innerHTML = html;
        document.getElementById('sub-total').innerText = `‚Çπ${mrpTotal.toLocaleString()}`;
        document.getElementById('saved-amt').innerText = `-‚Çπ${savings.toLocaleString()}`;
        document.getElementById('t-final').innerText = `‚Çπ${actualTotal.toLocaleString()}`;
        document.getElementById('m-final').innerText = `‚Çπ${actualTotal.toLocaleString()}`;
        document.getElementById('savings-msg').innerText = `üî• You saved ‚Çπ${savings.toLocaleString()} today!`;
    }

    // üî¥ EXACT PINCODE API LOGIC
    async function autoDetectLocation() {
        const pinInput = document.getElementById('s-pin');
        const cityInput = document.getElementById('s-city');
        const stateInput = document.getElementById('s-state');
        
        let pincode = pinInput.value.replace(/[^0-9]/g, '');
        pinInput.value = pincode;

        if (pincode.length === 6) {
            cityInput.value = "Detecting...";
            stateInput.value = "Detecting...";
            
            try {
                const response = await fetch(`https://api.postalpincode.in/postoffice/${pincode}`);
                const data = await response.json();

                if (data && data[0] && data[0].Status === "Success" && data[0].PostOffice && data[0].PostOffice.length > 0) {
                    const postOffice = data[0].PostOffice[0];
                    
                    let detectedCity = postOffice.District;
                    if (!detectedCity || detectedCity === "NA") {
                        detectedCity = postOffice.Block || postOffice.Region || postOffice.Name;
                    }
                    
                    cityInput.value = detectedCity;
                    stateInput.value = postOffice.State;
                    
                    pinInput.style.borderColor = "var(--green)";
                    cityInput.style.borderColor = "var(--green)";
                    stateInput.style.borderColor = "var(--green)";
                } else {
                    throw new Error("Invalid Pincode");
                }
            } catch (error) {
                console.error("API Error:", error);
                cityInput.value = "";
                stateInput.value = "";
                cityInput.placeholder = "Enter City manually";
                stateInput.placeholder = "Enter State manually";
                pinInput.style.borderColor = "red";
                showToast("Pincode not found. Please type City manually.");
            }
        } else {
            pinInput.style.borderColor = "var(--border-color)";
            cityInput.style.borderColor = "var(--border-color)";
            stateInput.style.borderColor = "var(--border-color)";
            if(cityInput.value === "Detecting...") {
                cityInput.value = "";
                stateInput.value = "";
            }
        }
    }

    // Invoice Function Removed

    async function placeOrder() {
        const name = document.getElementById('c-name').value.trim();
        const phone = document.getElementById('c-phone').value.trim();
        const address = document.getElementById('s-address').value.trim();
        const city = document.getElementById('s-city').value.trim();
        const state = document.getElementById('s-state').value.trim();
        const pin = document.getElementById('s-pin').value.trim();

        if (!name || phone.length !== 10 || !address || !city || !state || !pin) {
            showToast("Please fill all contact and address details correctly!");
            return;
        }

        const orderId = 'RJ' + Math.floor(Math.random() * 1000000);
        
        const itemsSummary = cartItems.map(i => `${i.name} (UK${i.size}) x${i.quantity}`).join(', ');
        const waMsg = encodeURIComponent(`üî• *‡§®‡§µ‡•Ä‡§® ‡§ë‡§∞‡•ç‡§°‡§∞ (RJ Sports)*\n\nüÜî ID: #${orderId}\nüë§ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: ${name}\nüìû ‡§´‡•ã‡§®: ${phone}\nüìç ‡§™‡§§‡•ç‡§§‡§æ: ${address}, ${city}, ${state} - ${pin}\nüõí ‡§µ‡§∏‡•ç‡§§‡•Ç: ${itemsSummary}\nüí∞ ‡§è‡§ï‡•Ç‡§£: ‚Çπ${finalTotal.toLocaleString()}\nüí≥ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü: Cash on Delivery\n\n_‡§ï‡•É‡§™‡§Ø‡§æ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡§æ!_`);
        
        window.location.href = `https://wa.me/919359239161?text=${waMsg}`;
        localStorage.removeItem('rj_cart');
    }
</script>
</body>
</html>