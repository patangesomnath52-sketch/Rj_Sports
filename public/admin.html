<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RJ Admin | Business Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        if (localStorage.getItem('rj_theme') === 'dark') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>

    <style>
        :root {
            --bg: #f4f6f8;
            --card-bg: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
            --accent: #ff3f6c;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        html.dark-mode {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f1f5f9;
            --border: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding: 20px; transition: 0.3s; }

        .container { max-width: 1150px; margin: 0 auto; }
        
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .theme-toggle { cursor: pointer; padding: 8px 15px; border-radius: 20px; background: var(--card-bg); border: 1px solid var(--border); font-size: 14px; font-weight: 600; }

        .card { background: var(--card-bg); padding: 25px; border-radius: 15px; border: 1px solid var(--border); box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 30px; }
        h2 { margin-bottom: 20px; font-size: 20px; font-weight: 800; display: flex; align-items: center; gap: 10px; }

        /* Form Grid */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        input, select { padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg); color: var(--text); outline: none; font-weight: 600; }
        
        .full-width { grid-column: span 2; }
        .file-wrapper { grid-column: span 2; border: 2px dashed var(--border); padding: 20px; text-align: center; border-radius: 10px; background: var(--bg); cursor: pointer; }
        
        .btn-add { background: var(--success); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: 800; cursor: pointer; grid-column: span 2; transition: 0.3s; font-size: 16px; }
        .btn-add:hover { background: #27ae60; transform: translateY(-2px); }

        /* Table Styles */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid var(--border); color: #888; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid var(--border); vertical-align: middle; }

        .product-info { display: flex; align-items: center; gap: 12px; }
        .product-info img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; background: #eee; }
        
        /* Status & Offer Badges */
        .badge { padding: 5px 12px; border-radius: 6px; font-size: 11px; font-weight: 800; display: inline-block; }
        .status-instock { background: #e8f5e9; color: #2e7d32; }
        .status-soldout { background: #ffebee; color: #c62828; }
        .offer-tag { background: #fff3e0; color: #ef6c00; border: 1px solid #ffe0b2; }

        .btn-delete { color: var(--danger); cursor: pointer; border: none; background: none; font-size: 18px; padding: 5px; }
        .btn-delete:hover { color: #c0392b; }

        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .full-width, .btn-add, .file-wrapper { grid-column: span 1; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="admin-header">
        <h1>RJ Sports <span style="color:var(--accent)">Business</span></h1>
        <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-adjust"></i> Theme Mode</div>
    </div>

    <div class="card">
        <h2><i class="fas fa-tag" style="color:var(--success)"></i> Add New Stock & Offers</h2>
        <form id="productForm">
            <div class="form-grid">
                <input type="text" name="productId" placeholder="Product ID (e.g. S10)" required>
                <input type="text" name="name" placeholder="Product Name" required>
                <input type="number" name="price" placeholder="Your Price (₹)" required>
                
                <input type="text" name="offerLabel" placeholder="Offer (e.g. 20% OFF / Buy 1 Get 1)">
                
                <select name="category">
                    <option value="Footwear">Footwear (शूज)</option>
                    <option value="Cricket">Cricket Gear (बॅट/बॉल)</option>
                    <option value="Apparel">Apparel (कपडे)</option>
                </select>

                <div class="file-wrapper">
                    <label style="font-weight: 700;"><i class="fas fa-cloud-upload-alt"></i> Upload Product Photos (Max 3)</label><br>
                    <input type="file" name="productImages" multiple accept="image/*" style="margin-top: 10px;">
                </div>
                
                <button type="submit" class="btn-add">SAVE & PUBLISH TO SITE</button>
            </div>
        </form>
    </div>

    <div class="card">
        <h2><i class="fas fa-list-ul" style="color:var(--accent)"></i> Current Inventory & Offers</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Product Details</th>
                        <th>Offer/Label</th>
                        <th>Stock Status</th>
                        <th>Sizes Available</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="inventory-list">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function toggleTheme() {
        document.documentElement.classList.toggle('dark-mode');
        localStorage.setItem('rj_theme', document.documentElement.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    async function loadInventory() {
        try {
            const res = await fetch('/api/products');
            const data = await res.json();
            const list = document.getElementById('inventory-list');
            
            if (data.success) {
                list.innerHTML = data.products.map(p => `
                    <tr>
                        <td>
                            <div class="product-info">
                                <img src="/${p.images[0]}" onerror="this.src='https://via.placeholder.com/50?text=RJ'">
                                <div>
                                    <div style="font-weight:700;">${p.name}</div>
                                    <div style="font-size:12px; color:#888;">ID: ${p.productId} | ₹${p.price}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            ${p.offerLabel ? `<span class="badge offer-tag"><i class="fas fa-fire"></i> ${p.offerLabel}</span>` : '<span style="color:#ccc; font-size:11px;">No Offer</span>'}
                        </td>
                        <td>
                            <span class="badge ${!p.isOutOfStock ? 'status-instock' : 'status-soldout'}">
                                ${!p.isOutOfStock ? '● IN STOCK' : '● SOLD OUT'}
                            </span>
                        </td>
                        <td>
                            <input type="text" value="${p.disabledSizes ? p.disabledSizes.join(', ') : ''}" 
                            onchange="updateSizes('${p.productId}', this.value)" 
                            style="width:70px; padding:5px; font-size:11px;" placeholder="Sizes">
                        </td>
                        <td>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <button onclick="toggleStock('${p.productId}', ${p.isOutOfStock})" style="font-size:11px; cursor:pointer; padding:4px 8px; border-radius:5px; border:1px solid var(--border);">Update Stock</button>
                                <button class="btn-delete" onclick="deleteProduct('${p.productId}')"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }
        } catch (err) { console.error("Failed to load inventory"); }
    }

    document.getElementById('productForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = e.target.querySelector('.btn-add');
        btn.innerText = "SAVING..."; btn.disabled = true;

        const formData = new FormData(e.target);
        try {
            const res = await fetch('/api/products/add', { method: 'POST', body: formData });
            const data = await res.json();
            if(data.success) { 
                alert("✅ प्रॉडक्ट आणि ऑफर अपडेट झाली!"); 
                loadInventory(); e.target.reset(); 
            }
        } catch (err) { alert("Server Error"); }
        finally { btn.innerText = "SAVE & PUBLISH TO SITE"; btn.disabled = false; }
    };

    async function toggleStock(productId, currentStatus) {
        await fetch('/api/stock/update', { 
            method: 'POST', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify({productId, isOutOfStock: !currentStatus}) 
        });
        loadInventory();
    }

    async function deleteProduct(productId) {
        if (confirm("Delete करायचे आहे का?")) {
            await fetch(`/api/products/${productId}`, { method: 'DELETE' });
            loadInventory();
        }
    }

    window.onload = loadInventory;
</script>
</body>
</html>