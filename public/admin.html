<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | RJ Sports</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Assistant', sans-serif; }
        body { background-color: #f3f4f6; color: #1f2937; display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: #111827; color: white; padding: 20px; display: flex; flex-direction: column; }
        .sidebar-logo { font-size: 24px; font-weight: 900; color: white; text-decoration: none; margin-bottom: 40px; text-align: center; display: block; }
        .sidebar-logo span { color: #ff3f6c; }
        .nav-item { padding: 15px; color: #9ca3af; text-decoration: none; font-weight: 600; border-radius: 8px; margin-bottom: 10px; transition: 0.3s; display: flex; align-items: center; gap: 15px; }
        .nav-item.active, .nav-item:hover { background: #1f2937; color: white; }
        
        /* Main Content */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header h1 { font-size: 28px; font-weight: 800; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); display: flex; align-items: center; justify-content: space-between; border-left: 5px solid #ff3f6c; }
        .stat-info h3 { color: #6b7280; font-size: 14px; text-transform: uppercase; margin-bottom: 5px; }
        .stat-info p { font-size: 28px; font-weight: 800; color: #111827; }
        .stat-icon { width: 50px; height: 50px; background: #fce7f3; color: #ff3f6c; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* Orders Table */
        .table-container { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); overflow-x: auto; padding: 20px; }
        .table-container h2 { margin-bottom: 20px; font-size: 18px; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #f3f4f6; }
        th { color: #6b7280; font-weight: 700; font-size: 13px; text-transform: uppercase; background: #f9fafb; }
        td { font-size: 15px; font-weight: 600; }
        
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        .badge-pending { background: #fef3c7; color: #d97706; }
        
        /* Access Denied Screen */
        #access-denied { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111827; color: white; z-index: 10000; align-items: center; justify-content: center; flex-direction: column; text-align: center; }
        #access-denied h1 { color: #ef4444; font-size: 40px; margin-bottom: 10px; }
        
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: auto; padding: 15px; flex-direction: row; justify-content: space-between; align-items: center; }
            .sidebar-logo { margin: 0; font-size: 20px; }
            .nav-item { display: none; } /* Hide menu texts on mobile */
            .main-content { padding: 15px; }
        }
    </style>
</head>
<body>

    <div id="access-denied">
        <i class="fas fa-lock" style="font-size: 60px; color: #ef4444; margin-bottom: 20px;"></i>
        <h1>Access Denied</h1>
        <p>You do not have permission to view this page.</p>
        <button onclick="window.location.href='index.html'" style="margin-top: 20px; padding: 10px 20px; background: #ff3f6c; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">Go to Home</button>
    </div>

    <div class="sidebar" id="admin-ui" style="display: none;">
        <a href="index.html" class="sidebar-logo">RJ <span>ADMIN</span></a>
        <a href="#" class="nav-item active"><i class="fas fa-box"></i> Live Orders</a>
        <a href="index.html" class="nav-item"><i class="fas fa-store"></i> Visit Store</a>
    </div>

    <div class="main-content" id="admin-main" style="display: none;">
        <div class="header">
            <h1>Dashboard Overview</h1>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-info">
                    <h3>Total Orders</h3>
                    <p id="total-orders-count">0</p>
                </div>
                <div class="stat-icon"><i class="fas fa-shopping-bag"></i></div>
            </div>
            <div class="stat-card">
                <div class="stat-info">
                    <h3>Total Revenue</h3>
                    <p>‚Çπ<span id="total-revenue">0</span></p>
                </div>
                <div class="stat-icon" style="background: #dcfce3; color: #22c55e;"><i class="fas fa-rupee-sign"></i></div>
            </div>
        </div>

        <div class="table-container">
            <h2>Recent Customer Orders</h2>
            <table>
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Date</th>
                        <th>Customer Details</th>
                        <th>Items Ordered</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="admin-orders-list">
                    <tr><td colspan="6" style="text-align:center; padding: 30px;">Loading orders... ‚è≥</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- 1. ADMIN SECURITY CHECK ---
        // üî¥ ‡§π‡§æ ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∏‡§ø‡§ï‡•ç‡§∞‡•á‡§ü ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Ü‡§π‡•á: rjadmin123
        const ADMIN_PASSWORD = "rjadmin123";
        
        window.onload = () => {
            const userInput = prompt("üîí Please enter Admin Password to access this panel:");
            
            if (userInput === ADMIN_PASSWORD) {
                // ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§∞‡•ã‡§¨‡§∞ ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§¶‡§æ‡§ñ‡§µ‡§æ
                document.getElementById('admin-ui').style.display = 'flex';
                document.getElementById('admin-main').style.display = 'block';
                fetchAdminOrders();
            } else {
                // ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ö‡•Å‡§ï‡•Ä‡§ö‡§æ ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§≤‡§æ‡§≤ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§¶‡§æ‡§ñ‡§µ‡§æ
                document.getElementById('access-denied').style.display = 'flex';
            }
        };

        // --- 2. FETCH ORDERS FROM DATABASE ---
        async function fetchAdminOrders() {
            const tableBody = document.getElementById('admin-orders-list');
            try {
                const response = await fetch('/api/orders');
                const data = await response.json();

                if (data.success && data.orders.length > 0) {
                    let totalSales = 0;
                    tableBody.innerHTML = ''; // Clear loading text

                    data.orders.forEach(order => {
                        totalSales += order.total; // ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞: ‡§è‡§ï‡•Ç‡§£ ‡§™‡•à‡§∏‡•á ‡§Æ‡•ã‡§ú‡§£‡•á
                        const date = new Date(order.date).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute:'2-digit' });
                        const itemsText = order.items ? order.items.map(i => `${i.name} (x${i.quantity})`).join('<br>') : 'N/A';

                        tableBody.innerHTML += `
                            <tr>
                                <td><span style="color:#ff3f6c;">#${order.orderId || 'RJ-NEW'}</span></td>
                                <td><span style="color:#6b7280; font-size:13px;">${date}</span></td>
                                <td>
                                    <b>${order.customer}</b><br>
                                    <span style="color:#6b7280; font-size:13px;">üìû ${order.phone || 'N/A'}</span><br>
                                    <span style="color:#6b7280; font-size:13px;">üìç ${order.address || 'N/A'}, ${order.pincode || ''}</span>
                                </td>
                                <td style="color:#4b5563; font-size:13px;">${itemsText}</td>
                                <td>‚Çπ${order.total}</td>
                                <td><span class="badge badge-pending">Processing</span></td>
                            </tr>
                        `;
                    });

                    // ‡§µ‡§∞‡§ö‡•á ‡§Ü‡§ï‡§°‡•á (Stats) ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§£‡•á
                    document.getElementById('total-orders-count').innerText = data.orders.length;
                    document.getElementById('total-revenue').innerText = totalSales.toLocaleString('en-IN');

                } else {
                    tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">No orders found in the database.</td></tr>';
                }
            } catch (error) {
                console.error("Error:", error);
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:red;">Connection Error. Check server.</td></tr>';
            }
        }
    </script>
</body>
</html>