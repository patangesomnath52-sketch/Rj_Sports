<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>RJ Sports Admin - Dashboard</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; }
        .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; position: fixed; padding: 20px; }
        .main-content { margin-left: 280px; padding: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 5px solid #d32f2f; }
        .stat-card h3 { margin: 0; color: #666; font-size: 14px; }
        .stat-card p { font-size: 24px; font-weight: bold; margin: 10px 0 0 0; color: #2c3e50; }
        table { width: 100%; background: white; border-collapse: collapse; border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #d32f2f; color: white; }
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .Pending { background: #fff3cd; color: #856404; }
        .Delivered { background: #d4edda; color: #155724; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>RJ Sports Admin</h2>
        <p>व्यवस्थापन पॅनेल</p>
        <hr>
        <button onclick="location.reload()" style="width:100%; padding:10px; cursor:pointer;">Refresh Orders</button>
    </div>

    <div class="main-content">
        <div class="stats-grid">
            <div class="stat-card">
                <h3>एकूण विक्री (Total Sales)</h3>
                <p id="totalSales">₹0</p>
            </div>
            <div class="stat-card" style="border-top-color: #3498db;">
                <h3>एकूण ऑर्डर्स (Total Orders)</h3>
                <p id="totalOrdersCount">0</p>
            </div>
            <div class="stat-card" style="border-top-color: #f1c40f;">
                <h3>बाकी ऑर्डर्स (Pending)</h3>
                <p id="pendingOrders">0</p>
            </div>
        </div>

        <h3>नवीन ऑर्डर्स (Recent Orders)</h3>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ग्राहक</th>
                    <th>रक्कम</th>
                    <th>स्थिती (Status)</th>
                    <th>ॲक्शन</th>
                </tr>
            </thead>
            <tbody id="adminOrderTable">
                </tbody>
        </table>
    </div>

    <script>
        async function fetchAdminData() {
            try {
                // १. सेल्स समरी लोड करणे
                const summaryRes = await fetch('/api/admin/sales-summary');
                const summary = await summaryRes.json();
                document.getElementById('totalSales').innerText = `₹${summary.totalSales}`;
                document.getElementById('totalOrdersCount').innerText = summary.totalOrders;
                document.getElementById('pendingOrders').innerText = summary.pending;

                // २. ऑर्डर्स लिस्ट लोड करणे
                const ordersRes = await fetch('/api/admin/all-orders');
                const orders = await ordersRes.json();
                const tableBody = document.getElementById('adminOrderTable');
                tableBody.innerHTML = '';

                orders.forEach(order => {
                    tableBody.innerHTML += `
                        <tr>
                            <td>#${order.orderId}</td>
                            <td>${order.customer}<br><small>${order.phone}</small></td>
                            <td>₹${order.total}</td>
                            <td><span class="status-badge ${order.status}">${order.status}</span></td>
                            <td>
                                <select onchange="updateStatus('${order.orderId}', this.value)">
                                    <option value="">Update</option>
                                    <option value="Confirmed">Confirm</option>
                                    <option value="Packed">Packed</option>
                                    <option value="Shipped">Shipped</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="Cancelled">Cancel</option>
                                </select>
                                <button onclick="deleteOrder('${order.orderId}')" style="color:red; margin-left:10px;">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (err) { console.error("Error loading admin data:", err); }
        }

        async function updateStatus(id, newStatus) {
            if(!newStatus) return;
            await fetch('/api/admin/update-status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ orderId: id, newStatus: newStatus })
            });
            fetchAdminData();
        }

        async function deleteOrder(id) {
            if(confirm('ही ऑर्डर कायमची काढायची का?')) {
                await fetch('/api/admin/delete-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ orderId: id })
                });
                fetchAdminData();
            }
        }

        // पेज उघडल्यावर डेटा लोड करा
        fetchAdminData();
    </script>
</body>
</html>